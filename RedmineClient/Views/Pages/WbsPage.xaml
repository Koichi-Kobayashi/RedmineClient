<Page
    x:Class="RedmineClient.Views.Pages.WbsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="clr-namespace:RedmineClient.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:RedmineClient.Models"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="WBS"
    d:DesignHeight="800"
    d:DesignWidth="1800"
    Focusable="True"
    KeyDown="Page_KeyDown"
    mc:Ignorable="d">

    <Grid Margin="5,0,5,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠž  -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="80" />
                <ColumnDefinition Width="300" />
                <ColumnDefinition Width="1600" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ui:TextBlock Grid.Column="0" Margin="0,0,8,0" VerticalAlignment="Center" Text="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:" />

            <ComboBox
                x:Name="ProjectComboBox" Grid.Column="1" Margin="0,0,16,0" DisplayMemberPath="Name"
                IsEnabled="{Binding ViewModel.IsProjectSelectionReadOnly, Converter={x:Static helpers:BooleanInverseConverter.Instance}}"
                ItemsSource="{Binding ViewModel.AvailableProjects}"
                SelectedItem="{Binding ViewModel.SelectedProject, Mode=TwoWay}" />

            <!--<ui:TextBlock Grid.Column="2" Margin="0,8,0,0" VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="{Binding ViewModel.ProjectSelectionDescription}" />-->

            <!--  ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒœã‚¿ãƒ³  -->
            <StackPanel Grid.Column="2" Margin="0,0,0,0" VerticalAlignment="Center" Orientation="Horizontal">
                <ui:Button Margin="0,0,8,0" Appearance="Primary" Command="{Binding ViewModel.AddRootItemCommand}" Content="ãƒ«ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯è¿½åŠ " Icon="Add" />
                <ui:Button
                    Margin="0,0,8,0"
                    Command="{Binding ViewModel.AddChildItemCommand}"
                    CommandParameter="{Binding ViewModel.SelectedItem}"
                    Content="å­ã‚¿ã‚¹ã‚¯è¿½åŠ " Icon="Add"
                    IsEnabled="{Binding ViewModel.CanAddChild}" />
                <ui:Button
                    Margin="0,0,8,0"
                    Command="{Binding ViewModel.AddMultipleChildrenCommand}"
                    CommandParameter="{Binding ViewModel.SelectedItem}"
                    Content="ä¸€æ‹¬ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¿½åŠ " Icon="Add"
                    IsEnabled="{Binding ViewModel.CanAddChild}" />
                <ui:Button
                    Margin="0,0,8,0"
                    Command="{Binding ViewModel.AddBatchChildrenCommand}"
                    CommandParameter="{Binding ViewModel.SelectedItem}"
                    Content="ãƒãƒƒãƒè¿½åŠ (20å€‹)" Icon="Add"
                    IsEnabled="{Binding ViewModel.CanAddChild}" />
                <ui:Button
                    Margin="0,0,8,0" Appearance="Danger"
                    Command="{Binding ViewModel.DeleteItemCommand}"
                    CommandParameter="{Binding ViewModel.SelectedItem}"
                    Content="å‰Šé™¤" Icon="Delete"
                    IsEnabled="{Binding ViewModel.CanAddChild}" />

                <!--  è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³  -->
                <StackPanel Margin="0,0,16,0" VerticalAlignment="Center" Orientation="Horizontal">
                    <ui:ToggleSwitch Margin="0,0,8,0" Content="è¿½åŠ å¾Œç·¨é›†ãƒ¢ãƒ¼ãƒ‰" IsChecked="{Binding ViewModel.IsEditModeAfterAdd, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <ui:TextBlock Margin="4,8,8,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="ON:è¿½åŠ å¾Œç·¨é›†ã€OFF:é€£ç¶šè¿½åŠ " />
                    <ui:TextBlock Margin="4,8,0,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="{Binding ViewModel.IsEditModeAfter, StringFormat=ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: {0}}" />
                </StackPanel>

                <StackPanel Margin="0,0,16,0" VerticalAlignment="Center" Orientation="Horizontal">
                    <ui:ToggleSwitch Margin="0,0,8,0" Content="ã‚¿ã‚¹ã‚¯è©³ç´°è¡¨ç¤º" IsChecked="{Binding ViewModel.IsTaskDetailVisible, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <ui:TextBlock Margin="4,8,8,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="ON:è©³ç´°è¡¨ç¤ºã€OFF:è©³ç´°éžè¡¨ç¤º" />
                    <ui:TextBlock Margin="4,8,0,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Text="{Binding ViewModel.IsTaskDetailVisible, StringFormat=è©³ç´°è¡¨ç¤º: {0}}" />
                </StackPanel>
            </StackPanel>
        </Grid>

        <!--  æ“ä½œãƒœã‚¿ãƒ³ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼  -->
        <StackPanel Grid.Row="1" Margin="0,8,0,16" Orientation="Horizontal">
            <!--  è¡¨ç¤ºåˆ¶å¾¡ãƒœã‚¿ãƒ³  -->
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.ExpandAllCommand}" Content="å…¨å±•é–‹" Icon="ChevronDown" />
            <ui:Button Margin="0,0,16,0" Command="{Binding ViewModel.CollapseAllCommand}" Content="å…¨æŠ˜ã‚ŠãŸãŸã¿" Icon="ChevronUp" />

            <!--  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š  -->
            <StackPanel Margin="0,0,16,0" Orientation="Horizontal">
                <ui:TextBlock Margin="0,0,5,0" VerticalAlignment="Center" Text="ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹å§‹å¹´æœˆ:" />
                <ComboBox x:Name="ScheduleStartYearMonthComboBox" Width="100" VerticalAlignment="Center" SelectedItem="{Binding ViewModel.ScheduleStartYearMonth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" SelectionChanged="ScheduleStartYearMonthComboBox_SelectionChanged" />
                <ui:ToggleSwitch Margin="16,0,0,0" Content="ä»Šæ—¥ã®æ—¥ä»˜ãƒ©ã‚¤ãƒ³" IsChecked="{Binding ViewModel.ShowTodayLine, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            </StackPanel>

            <!--  éšŽå±¤è¡¨ç¤ºã®èª¬æ˜Ž  -->
            <StackPanel Margin="0,0,16,0" Orientation="Horizontal">
                <ui:TextBlock Margin="0,8,8,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="éšŽå±¤è¡¨ç¤º:" />
                <ui:TextBlock Margin="0,8,0,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="ðŸ“ãƒ«ãƒ¼ãƒˆ ðŸ“‚ç¬¬2éšŽå±¤ ðŸ“„ç¬¬3éšŽå±¤ ðŸ“‹ç¬¬4éšŽå±¤" />
            </StackPanel>

            <!--  å…ˆè¡Œãƒ»å¾Œç¶šã®é–¢ä¿‚æ€§è¨­å®šèª¬æ˜Ž  -->
            <StackPanel Margin="0,0,16,0" Orientation="Horizontal">
                <ui:TextBlock Margin="0,8,8,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="å…ˆè¡Œã‚¿ã‚¹ã‚¯:" />
                <ui:TextBlock Margin="0,8,0,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="å…ˆè¡Œã‚¿ã‚¹ã‚¯åˆ—ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã‚¿ã‚¹ã‚¯ãŒå¾Œç¶šã«ãªã‚‹" />
            </StackPanel>

            <!--  ä¾å­˜é–¢ä¿‚çŸ¢å°ã®è¡¨ç¤ºè¨­å®š  -->
            <StackPanel Margin="0,0,16,0" Orientation="Horizontal">
                <ui:ToggleSwitch Margin="0,0,8,0" Content="ä¾å­˜é–¢ä¿‚çŸ¢å°" IsChecked="{Binding ViewModel.ShowDependencyArrows, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <ui:TextBlock Margin="4,8,0,0" VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="ON:çŸ¢å°è¡¨ç¤ºã€OFF:çŸ¢å°éžè¡¨ç¤º" />
            </StackPanel>

            <!--  ç®¡ç†æ©Ÿèƒ½ãƒœã‚¿ãƒ³  -->
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.UpdateProgressCommand}" Content="é€²æ—æ›´æ–°" Icon="Refresh" />
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.LimitHierarchyCommand}" Content="éšŽå±¤åˆ¶é™" Icon="Settings" />
            <ui:Button Margin="0,0,16,0" Command="{Binding ViewModel.SettingsCommand}" Content="è¨­å®š" Icon="Settings" />

            <!--  ãƒ‡ãƒ¼ã‚¿æ“ä½œãƒœã‚¿ãƒ³  -->
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.RefreshCommand}" Content="æ›´æ–°" Icon="ArrowClockwise" />
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.CreateNewIssueCommand}" Content="ãƒã‚±ãƒƒãƒˆç™»éŒ²" Icon="Add" />
            <ui:Button
                Margin="0,0,8,0" Appearance="Success"
                Command="{Binding ViewModel.RegisterItemsCommand}"
                Content="{Binding ViewModel.NewItemsCount, StringFormat=ç™»éŒ² ({0})}"
                Icon="CloudAdd"
                IsEnabled="{Binding ViewModel.CanRegisterItems}"
                ToolTip="æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’Redmineã«ç™»éŒ²ã—ã¾ã™" />
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.LoadRedmineDataCommand}" Content="Redmineèª­ã¿è¾¼ã¿" Icon="ArrowImportDown" />
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.RefreshRedmineDataCommand}" Content="Redmineæ›´æ–°" Icon="ArrowClockwise" />
            <ui:Button Margin="0,0,8,0" Command="{Binding ViewModel.ExportCommand}" Content="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ" Icon="ArrowExportUp" />
            <ui:Button Margin="0,0,0,0" Command="{Binding ViewModel.ImportCommand}" Content="ã‚¤ãƒ³ãƒãƒ¼ãƒˆ" Icon="ArrowImportDown" />
        </StackPanel>

        <!--  æŽ¥ç¶šçŠ¶æ…‹ã¨ã‚¨ãƒ©ãƒ¼è¡¨ç¤º  -->
        <Grid Grid.Row="2" Margin="0,0,0,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  æŽ¥ç¶šçŠ¶æ…‹  -->
            <StackPanel Grid.Row="0" Margin="0,0,0,8" Orientation="Horizontal">
                <Border Margin="0,0,8,0" Padding="8,4" Background="{Binding ViewModel.IsRedmineConnected, Converter={x:Static helpers:BooleanToBrushConverter.Instance}}" CornerRadius="4">
                    <ui:TextBlock HorizontalAlignment="Center" FontTypography="Caption" Foreground="White" Text="{Binding ViewModel.ConnectionStatus}" />
                </Border>
            </StackPanel>

            <!--  ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸  -->
            <ui:Card Grid.Row="1" Padding="12" BorderThickness="1" Visibility="{Binding ViewModel.ErrorMessage, Converter={x:Static helpers:ObjectToVisibilityConverter.Instance}}">
                <ui:TextBlock FontTypography="Caption" Text="{Binding ViewModel.ErrorMessage}" TextWrapping="Wrap" />
            </ui:Card>
        </Grid>

        <!--  ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨æ¤œç´¢  -->
        <Grid Grid.Row="3" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ui:TextBox Grid.Column="0" Margin="0,8,0,0" Icon="Search" PlaceholderText="ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." Text="{Binding ViewModel.SearchText, UpdateSourceTrigger=PropertyChanged}" />

            <StackPanel Grid.Column="1" Margin="16,8,0,0" Orientation="Horizontal">
                <ui:TextBlock Margin="0,0,8,0" VerticalAlignment="Center" Text="æ‹…å½“è€…:" />
                <ComboBox Width="120" ItemsSource="{Binding ViewModel.AvailableAssignees}" SelectedItem="{Binding ViewModel.SelectedAssignee, Mode=TwoWay}" />
            </StackPanel>

            <ui:ToggleSwitch Grid.Column="2" Margin="16,8,0,0" Content="å®Œäº†" IsChecked="{Binding ViewModel.ShowCompleted}" />

            <ui:ToggleSwitch Grid.Column="3" Margin="16,8,0,0" Content="é€²è¡Œä¸­" IsChecked="{Binding ViewModel.ShowInProgress}" />

            <ui:ToggleSwitch Grid.Column="4" Margin="16,8,0,0" Content="æœªç€æ‰‹" IsChecked="{Binding ViewModel.ShowNotStarted}" />
        </Grid>

        <!--  ãƒšãƒ¼ã‚¸ãƒ³ã‚°åˆ¶å¾¡  -->
        <Grid Grid.Row="4" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ui:TextBlock Grid.Column="0" Margin="0,0,8,0" VerticalAlignment="Center" Text="ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º:" />

            <ComboBox
                Grid.Column="1" Width="80" Margin="0,0,16,0" VerticalAlignment="Center"
                ItemsSource="{Binding ViewModel.PageSizeOptions}"
                SelectedItem="{Binding ViewModel.SelectedPageSize, Mode=TwoWay}" />

            <ui:Button Grid.Column="2" Margin="0,0,8,0" Command="{Binding ViewModel.FirstPageCommand}" Content="&lt;&lt;" ToolTip="æœ€åˆã®ãƒšãƒ¼ã‚¸" />
            <ui:Button Grid.Column="3" Margin="0,0,8,0" Command="{Binding ViewModel.PreviousPageCommand}" Content="&lt;" ToolTip="å‰ã®ãƒšãƒ¼ã‚¸" />

            <ui:TextBlock Grid.Column="4" Margin="8,0,8,0" VerticalAlignment="Center" Text="{Binding ViewModel.CurrentPage, StringFormat=ãƒšãƒ¼ã‚¸ {0}}" />

            <ui:TextBlock Grid.Column="5" Margin="0,0,8,0" VerticalAlignment="Center" Text="{Binding ViewModel.TotalPages, StringFormat=/ {0}}" />

            <ui:Button Grid.Column="6" Margin="8,0,8,0" Command="{Binding ViewModel.NextPageCommand}" Content="&gt;" ToolTip="æ¬¡ã®ãƒšãƒ¼ã‚¸" />
            <ui:Button Grid.Column="7" Margin="0,0,16,0" Command="{Binding ViewModel.LastPageCommand}" Content="&gt;&gt;" ToolTip="æœ€å¾Œã®ãƒšãƒ¼ã‚¸" />

            <ui:TextBlock Grid.Column="8" Margin="0,0,0,0" VerticalAlignment="Center" Text="{Binding ViewModel.FilteredItems, StringFormat=è¡¨ç¤ºä¸­: {0} ä»¶}" />
        </Grid>

        <!--  WBSãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼  -->
        <Grid x:Name="MainContentGrid" Grid.Row="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="DataGridColumn" Width="*" />
                <ColumnDefinition x:Name="TaskDetailColumn" Width="16" />
            </Grid.ColumnDefinitions>

            <!--  å·¦å´ï¼šDataGridã¨ä¾å­˜é–¢ä¿‚çŸ¢å°ã®é‡ã­è¡¨ç¤º  -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <!--  DataGrid  -->
                <DataGrid
                    x:Name="WbsDataGrid" Grid.Row="0" MinHeight="200"
                    MaxHeight="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=ActualHeight}"
                    Margin="0,0,8,0" VerticalAlignment="Stretch" AllowDrop="True"
                    AlternatingRowBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                    AutoGenerateColumns="False"
                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                    BorderThickness="1" CanUserAddRows="False" CanUserDeleteRows="False" CanUserReorderColumns="False" CanUserResizeColumns="True"
                    CanUserSortColumns="True" DragEnter="WbsDataGrid_DragEnter" DragLeave="WbsDataGrid_DragLeave" Drop="WbsDataGrid_Drop" EnableColumnVirtualization="True"
                    EnableRowVirtualization="True" FrozenColumnCount="2" GridLinesVisibility="All" HeadersVisibility="Column"
                    ItemsSource="{Binding ViewModel.FlattenedWbsItems}"
                    RowBackground="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    RowHeaderWidth="0" ScrollViewer.CanContentScroll="True" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.IsDeferredScrollingEnabled="False" ScrollViewer.PanningMode="Both"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    SelectedItem="{Binding ViewModel.SelectedItem, Mode=TwoWay}"
                    SelectionMode="Single" SelectionUnit="FullRow" VirtualizingPanel.CacheLength="3,3" VirtualizingPanel.CacheLengthUnit="Page" VirtualizingPanel.IsContainerVirtualizable="True"
                    VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.ScrollUnit="Pixel" VirtualizingPanel.VirtualizationMode="Recycling">



                    <!--  ä¾å­˜é–¢ä¿‚ã®çŸ¢å°ã‚’è¡¨ç¤ºã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆæœ€å‰é¢ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®æ“ä½œã‚’å¦¨ã’ãªã„ï¼‰  -->

                    <DataGrid.Resources>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource DividerStrokeColorDefaultBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,1,1" />
                            <Setter Property="Padding" Value="4,2" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border
                                            Margin="0,0,0,0"
                                            Padding="{TemplateBinding Padding}"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            ClipToBounds="True">
                                            <ContentPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorSecondaryBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource DividerStrokeColorDefaultBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,1,1" />
                            <Setter Property="Padding" Value="8,4" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridColumnHeader">
                                        <Border
                                            Margin="0,0,0,0"
                                            Padding="{TemplateBinding Padding}"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            ClipToBounds="True">
                                            <ContentPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource DividerStrokeColorDefaultBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}" />
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource SystemFillColorAttentionBrush}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                        <Style TargetType="ScrollBar">
                            <Setter Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                        </Style>
                        <Style TargetType="Thumb">
                            <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlFillColorTertiaryBrush}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                        <Style TargetType="RepeatButton">
                            <Setter Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}" />
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                        <!--  æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«  -->
                        <Style x:Key="DateHeaderStyle" TargetType="DataGridColumnHeader">
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
                            <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorSecondaryBrush}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource DividerStrokeColorDefaultBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,1,1" />
                            <Setter Property="Padding" Value="2,2" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="FontSize" Value="8" />
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                            <Setter Property="Height" Value="40" />
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <!--  IDåˆ—  -->
                        <DataGridTemplateColumn MinWidth="80" Header="ID" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border
                                        Padding="4,2" Background="Transparent" BorderBrush="Transparent" BorderThickness="1" CornerRadius="2"
                                        Cursor="Hand" MouseLeftButtonDown="IdColumn_MouseLeftButtonDown">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Blue" Text="{Binding Id}" TextDecorations="Underline" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  ã‚¿ã‚¹ã‚¯ååˆ—  -->
                        <DataGridTemplateColumn Width="Auto" MinWidth="300" Header="ã‚¿ã‚¹ã‚¯å">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³ï¼ˆå­ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰  -->
                                        <Border
                                            Grid.Column="0"
                                            Margin="{Binding Level, Converter={x:Static helpers:LevelToIndentConverter.Instance}}"
                                            Padding="4,2"
                                            Background="{DynamicResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                                            BorderThickness="1" CornerRadius="3" Cursor="Hand"
                                            DataContext="{Binding}"
                                            MouseLeftButtonDown="ExpansionText_MouseLeftButtonDown"
                                            Visibility="{Binding HasChildren, Converter={x:Static helpers:BoolToVisibilityConverter.Instance}}">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Width="12" Height="12" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Symbol="{Binding IsExpanded, Converter={x:Static helpers:ExpansionToIconConverter.Instance}}" />
                                                <ui:TextBlock
                                                    Margin="4,0,0,0" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"
                                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                                    Text="{Binding IsExpanded, Converter={x:Static helpers:ExpansionToTextConverter.Instance}}"
                                                    TextWrapping="Wrap" />
                                            </StackPanel>
                                        </Border>

                                        <!--  å­ã‚¿ã‚¹ã‚¯ãŒãªã„å ´åˆã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚¹ãƒšãƒ¼ã‚µãƒ¼  -->
                                        <StackPanel Grid.Column="0" Margin="{Binding Level, Converter={x:Static helpers:LevelToIndentConverter.Instance}}" Orientation="Horizontal" Visibility="{Binding HasChildren, Converter={x:Static helpers:BooleanInverseConverter.Instance}}">
                                            <Border Width="20" Height="20" />
                                        </StackPanel>

                                        <!--  éšŽå±¤ãƒ¬ãƒ™ãƒ«è¡¨ç¤º  -->
                                        <Border
                                            Grid.Column="2" Padding="4,2" AllowDrop="True"
                                            Background="{Binding IsSelected, Converter={x:Static helpers:SelectionHighlightConverter.Instance}}"
                                            BorderBrush="{Binding IsSelected, Converter={x:Static helpers:SelectionBorderConverter.Instance}}"
                                            BorderThickness="1" CornerRadius="3" Cursor="Hand" DragEnter="TaskBorder_DragEnter" DragLeave="TaskBorder_DragLeave"
                                            Drop="TaskBorder_Drop" MouseLeftButtonDown="TaskBorder_MouseLeftButtonDown" MouseLeftButtonUp="TaskBorder_MouseLeftButtonUp" MouseMove="TaskBorder_MouseMove">
                                            <Border.InputBindings>
                                                <MouseBinding Command="{Binding DataContext.ViewModel.SelectItemCommand, RelativeSource={RelativeSource AncestorType=Page}}" CommandParameter="{Binding}" MouseAction="LeftClick" />
                                            </Border.InputBindings>
                                            <StackPanel Orientation="Horizontal">
                                                <!--  éšŽå±¤ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè¡¨ç¤ºï¼ˆæ”¹å–„ç‰ˆï¼‰  -->
                                                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                    <!--  éšŽå±¤ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè¦–è¦šçš„ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼  -->
                                                    <ui:TextBlock VerticalAlignment="Center" FontFamily="Consolas, Courier New, monospace" FontSize="10" Foreground="{Binding Level, Converter={x:Static helpers:LevelToColorConverter.Instance}}" Text="{Binding Level, Converter={x:Static helpers:LevelToIndentStringConverter.Instance}}" />

                                                    <!--  è¦ªã‚¿ã‚¹ã‚¯ã®å ´åˆã¯éšŽå±¤ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ   -->
                                                    <ui:TextBlock
                                                        Margin="2,0,0,0" VerticalAlignment="Center" FontSize="12"
                                                        Foreground="{Binding Level, Converter={x:Static helpers:LevelToColorConverter.Instance}}"
                                                        Text="{Binding Level, Converter={x:Static helpers:LevelToHierarchyIndicatorConverter.Instance}}"
                                                        Visibility="{Binding HasChildren, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}" />
                                                </StackPanel>

                                                <!--  ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆéšŽå±¤ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ³ãƒˆã‚¦ã‚§ã‚¤ãƒˆã‚’å¤‰æ›´ï¼‰  -->
                                                <ui:TextBlock
                                                    Margin="4,0,0,0" VerticalAlignment="Center" FontSize="13"
                                                    FontWeight="{Binding Level, Converter={x:Static helpers:LevelToFontWeightConverter.Instance}}"
                                                    Foreground="#000000"
                                                    Text="{Binding Title}" />

                                                <!--  å­ã‚¿ã‚¹ã‚¯æ•°ã®è¡¨ç¤ºï¼ˆè¦ªã‚¿ã‚¹ã‚¯ã®å ´åˆï¼‰  -->
                                                <ui:TextBlock
                                                    Margin="8,0,0,0" VerticalAlignment="Center" FontSize="11"
                                                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                    Text="{Binding Children.Count, StringFormat=({0}å€‹ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯)}"
                                                    Visibility="{Binding HasChildren, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}" />
                                            </StackPanel>
                                        </Border>

                                        <!--  ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼  -->
                                        <Grid.ContextMenu>
                                            <ContextMenu Opened="ContextMenu_Opened">
                                                <ui:MenuItem Header="ã‚µãƒ–ã‚¿ã‚¹ã‚¯è¿½åŠ ">
                                                    <ui:MenuItem.Icon>
                                                        <ui:SymbolIcon Symbol="Add16" />
                                                    </ui:MenuItem.Icon>
                                                </ui:MenuItem>
                                                <ui:MenuItem Header="ç·¨é›†">
                                                    <ui:MenuItem.Icon>
                                                        <ui:SymbolIcon Symbol="Edit16" />
                                                    </ui:MenuItem.Icon>
                                                </ui:MenuItem>
                                                <Separator />
                                                <ui:MenuItem Header="ä¾å­˜é–¢ä¿‚ç®¡ç†">
                                                    <ui:MenuItem.Icon>
                                                        <ui:SymbolIcon Symbol="Link16" />
                                                    </ui:MenuItem.Icon>
                                                    <ui:MenuItem Command="{Binding ViewModel.RemovePredecessorCommand}" CommandParameter="{Binding}" Header="å…ˆè¡Œã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤" Visibility="{Binding HasPredecessors, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                                                        <ui:MenuItem.Icon>
                                                            <ui:SymbolIcon Symbol="ArrowUp16" />
                                                        </ui:MenuItem.Icon>
                                                    </ui:MenuItem>
                                                    <ui:MenuItem Command="{Binding ViewModel.RemoveSuccessorCommand}" CommandParameter="{Binding}" Header="å¾Œç¶šã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤" Visibility="{Binding HasSuccessors, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                                                        <ui:MenuItem.Icon>
                                                            <ui:SymbolIcon Symbol="ArrowDown16" />
                                                        </ui:MenuItem.Icon>
                                                    </ui:MenuItem>
                                                </ui:MenuItem>
                                                <Separator />
                                                <ui:MenuItem Header="å‰Šé™¤">
                                                    <ui:MenuItem.Icon>
                                                        <ui:SymbolIcon Symbol="Delete16" />
                                                    </ui:MenuItem.Icon>
                                                </ui:MenuItem>
                                            </ContextMenu>
                                        </Grid.ContextMenu>
                                    </Grid>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  é–‹å§‹æ—¥åˆ—  -->
                        <DataGridTemplateColumn MinWidth="100" Header="é–‹å§‹æ—¥">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2" Background="Transparent" BorderBrush="Transparent" BorderThickness="1" CornerRadius="2">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding StartDate, StringFormat=yyyy/MM/dd}" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker
                                        DisplayDateEnd="2100-12-31" DisplayDateStart="1900-01-01" FirstDayOfWeek="Monday" GotFocus="DatePicker_GotFocus" IsTodayHighlighted="True"
                                        SelectedDate="{Binding StartDate, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged" SelectedDateFormat="Short" Tag="StartDate" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <!--  çµ‚äº†æ—¥åˆ—  -->
                        <DataGridTemplateColumn MinWidth="100" Header="çµ‚äº†æ—¥">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2" Background="Transparent" BorderBrush="Transparent" BorderThickness="1" CornerRadius="2">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding EndDate, StringFormat=yyyy/MM/dd}" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                            <DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <DatePicker
                                        DisplayDateEnd="2100-12-31" DisplayDateStart="1900-01-01" FirstDayOfWeek="Monday" GotFocus="DatePicker_GotFocus" IsTodayHighlighted="True"
                                        SelectedDate="{Binding EndDate, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged" SelectedDateFormat="Short" Tag="EndDate" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellEditingTemplate>
                        </DataGridTemplateColumn>

                        <!--  é€²æ—åˆ—  -->
                        <DataGridTemplateColumn MinWidth="150" Header="é€²æ—" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <!--  ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼  -->
                                        <Border
                                            Grid.Column="0" Height="16" Margin="0,0,8,0"
                                            Background="{DynamicResource SubtleFillColorTertiaryBrush}"
                                            BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                                            BorderThickness="1" CornerRadius="2">
                                            <Border Width="{Binding TotalProgress, Converter={x:Static helpers:ProgressToWidthConverter.Instance}}" HorizontalAlignment="Left" Background="{Binding TotalProgress, Converter={x:Static helpers:ProgressToColorConverter.Instance}}" CornerRadius="1" />
                                        </Border>

                                        <!--  é€²æ—ãƒ†ã‚­ã‚¹ãƒˆ  -->
                                        <ui:TextBlock
                                            Grid.Column="1" MinWidth="40" VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold"
                                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                            Text="{Binding TotalProgress, StringFormat={}{0:F0}%}" />
                                    </Grid>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ—  -->
                        <DataGridTemplateColumn MinWidth="80" Header="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2" Background="{Binding Status, Converter={x:Static helpers:StatusToBrushConverter.Instance}}" CornerRadius="2">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="12" Foreground="White" Text="{Binding Status}" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  å„ªå…ˆåº¦åˆ—  -->
                        <DataGridTemplateColumn MinWidth="80" Header="å„ªå…ˆåº¦" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2" Background="{Binding Priority, Converter={x:Static helpers:PriorityToBrushConverter.Instance}}" CornerRadius="2">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="12" Foreground="White" Text="{Binding Priority}" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  æ‹…å½“è€…åˆ—  -->
                        <DataGridTemplateColumn Width="Auto" MinWidth="100" Header="æ‹…å½“è€…" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Padding="4,2">
                                        <ui:TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="12" Text="{Binding Assignee}" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  å…ˆè¡Œãƒ»å¾Œç¶šåˆ—  -->
                        <DataGridTemplateColumn Width="Auto" MinWidth="120" Header="å…ˆè¡Œã‚¿ã‚¹ã‚¯&#x0d;&#x0a;D&amp;D" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  å…ˆè¡Œã‚¿ã‚¹ã‚¯IDè¡¨ç¤ºï¼ˆå¾Œç¶šã‚¿ã‚¹ã‚¯ã®è¡Œã«è¡¨ç¤ºï¼‰  -->
                                        <StackPanel Grid.Column="0" Margin="2,0" Orientation="Horizontal" Visibility="{Binding HasPredecessors, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                                            <ui:TextBlock Foreground="Orange" Text="å…ˆè¡Œ: " />
                                            <ui:TextBlock Foreground="Orange" Text="{Binding Predecessors, Converter={x:Static helpers:PredecessorsToIdStringConverter.Instance}}" />
                                        </StackPanel>

                                        <!--  ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆå…ˆè¡Œãƒ»å¾Œç¶šè¨­å®šç”¨ï¼‰- å¸¸ã«è¡¨ç¤º  -->
                                        <Border
                                            Grid.Column="0" Padding="4,2" AllowDrop="True" Background="Transparent" BorderBrush="Transparent"
                                            BorderThickness="1" CornerRadius="2" DragEnter="DependencyDrop_DragEnter" DragLeave="DependencyDrop_DragLeave" Drop="DependencyDrop_Drop" />

                                        <!--  ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆè©³ç´°æƒ…å ±è¡¨ç¤ºï¼‰  -->
                                        <Grid.ToolTip>
                                            <StackPanel MinWidth="250" MaxWidth="400">
                                                <ui:TextBlock Margin="0,0,0,12" FontSize="14" FontWeight="Bold" Text="å…ˆè¡Œãƒ»å¾Œç¶šã®é–¢ä¿‚æ€§" />

                                                <!--  å…ˆè¡Œã‚¿ã‚¹ã‚¯  -->
                                                <StackPanel Margin="0,0,0,12" Visibility="{Binding HasPredecessors, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                                                    <ui:SymbolIcon Width="12" Height="12" Margin="0,0,4,0" Foreground="Orange" Symbol="ArrowUp16" />
                                                    <ui:TextBlock FontSize="11" FontWeight="SemiBold" Text="{Binding Title}" />
                                                    <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text=" (ID: " />
                                                    <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="{Binding Id}" />
                                                    <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text=")" />
                                                </StackPanel>

                                                <!--  å¾Œç¶šã‚¿ã‚¹ã‚¯  -->
                                                <StackPanel Margin="0,0,0,12" Visibility="{Binding HasSuccessors, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                                                    <ui:TextBlock Margin="0,0,0,4" FontSize="12" FontWeight="SemiBold" Foreground="Blue" Text="å¾Œç¶šã‚¿ã‚¹ã‚¯:" />
                                                    <Border Padding="8,6" Background="#E3F2FD" BorderBrush="Blue" BorderThickness="1" CornerRadius="4">
                                                        <ItemsControl ItemsSource="{Binding Successors}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Margin="0,2" Orientation="Horizontal">
                                                                        <ui:SymbolIcon Width="12" Height="12" Margin="0,0,4,0" Foreground="Blue" Symbol="ArrowDown16" />
                                                                        <ui:TextBlock FontSize="11" FontWeight="SemiBold" Text="{Binding Title}" />
                                                                        <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text=" (ID: " />
                                                                        <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="{Binding Id}" />
                                                                        <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text=")" />
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </Border>
                                                </StackPanel>

                                                <!--  ä½¿ç”¨æ–¹æ³•  -->
                                                <Border Padding="8,6" Background="#F5F5F5" BorderBrush="{DynamicResource TextFillColorSecondaryBrush}" BorderThickness="1" CornerRadius="4">
                                                    <ui:TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="ä½¿ç”¨æ–¹æ³•: ã‚¿ã‚¹ã‚¯åã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã“ã®åˆ—ã«ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã¨å…ˆè¡Œé–¢ä¿‚ã‚’è¨­å®šã§ãã¾ã™" TextWrapping="Wrap" />
                                                </Border>
                                            </StackPanel>
                                        </Grid.ToolTip>
                                    </Grid>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!--  æ—¥ä»˜åˆ—ã¯ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã§å‹•çš„ã«ç”Ÿæˆ  -->
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Padding" Value="4,2" />
                            <Setter Property="Margin" Value="0,1" />
                            <Setter Property="AllowDrop" Value="True" />
                            <EventSetter Event="Drop" Handler="DataGridRow_Drop" />
                            <EventSetter Event="DragEnter" Handler="DataGridRow_DragEnter" />
                            <EventSetter Event="DragLeave" Handler="DataGridRow_DragLeave" />
                            <Style.Triggers>
                                <!--  éšŽå±¤ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸèƒŒæ™¯è‰²  -->
                                <DataTrigger Binding="{Binding Level}" Value="1">
                                    <Setter Property="Background" Value="#E3F2FD" />
                                    <Setter Property="BorderBrush" Value="#2196F3" />
                                    <Setter Property="BorderThickness" Value="0,0,0,2" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Level}" Value="2">
                                    <Setter Property="Background" Value="#F3E5F5" />
                                    <Setter Property="BorderBrush" Value="#9C27B0" />
                                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Level}" Value="3">
                                    <Setter Property="Background" Value="#FFF3E0" />
                                    <Setter Property="BorderBrush" Value="#FF9800" />
                                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Level}" Value="4">
                                    <Setter Property="Background" Value="#E8F5E8" />
                                    <Setter Property="BorderBrush" Value="#4CAF50" />
                                    <Setter Property="BorderThickness" Value="0,0,0,1" />
                                </DataTrigger>

                                <!--  å…ˆè¡Œã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹å ´åˆã®å¼·èª¿è¡¨ç¤º  -->
                                <DataTrigger Binding="{Binding HasPredecessors}" Value="True">
                                    <Setter Property="Background" Value="#FFF8E1" />
                                </DataTrigger>

                                <!--  é¸æŠžçŠ¶æ…‹ã®å„ªå…ˆåº¦ã‚’ä¸Šã’ã‚‹  -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#E5F3FF" />
                                    <Setter Property="BorderBrush" Value="Blue" />
                                    <Setter Property="BorderThickness" Value="2" />
                                </Trigger>

                                <!--  ãƒžã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼çŠ¶æ…‹  -->
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F0F0F0" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.InputBindings>
                        <KeyBinding Key="Up" Command="{Binding ViewModel.MoveUpCommand}" />
                        <KeyBinding Key="Down" Command="{Binding ViewModel.MoveDownCommand}" />
                        <KeyBinding Key="Left" Command="{Binding ViewModel.MoveLeftCommand}" />
                        <KeyBinding Key="Right" Command="{Binding ViewModel.MoveRightCommand}" />
                    </DataGrid.InputBindings>
                </DataGrid>

                <!--  WBSãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤  -->
                <Border Grid.Row="0" Grid.Column="0" Panel.ZIndex="1001" Background="#80000066" Visibility="{Binding ViewModel.IsWbsLoading, Converter={x:Static helpers:BoolToVisibilityConverter.Instance}}">
                    <Grid>
                        <StackPanel Width="300" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Margin="0,0,0,8" HorizontalAlignment="Center" FontSize="14" Foreground="White" Text="{Binding ViewModel.WbsProgressMessage}" />
                            <ProgressBar
                                Width="240" Height="8" HorizontalAlignment="Center" IsIndeterminate="False" Maximum="100"
                                Value="{Binding ViewModel.WbsProgress}" />
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!--  å³å´ï¼šã‚¿ã‚¹ã‚¯è©³ç´°ï¼ˆã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ï¼‰  -->
            <ui:Card
                Grid.Column="1" Width="400" Padding="20" HorizontalAlignment="Right" VerticalAlignment="Top"
                Panel.ZIndex="999"
                Visibility="{Binding ViewModel.IsTaskDetailVisible, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}">
                <ui:Card.RenderTransform>
                    <TranslateTransform x:Name="TaskDetailTransform" X="400" />
                </ui:Card.RenderTransform>
                <ui:Card.Triggers>
                    <EventTrigger RoutedEvent="ui:Card.Loaded">
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetName="TaskDetailTransform" Storyboard.TargetProperty="X" To="0" Duration="0:0:0.3" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </ui:Card.Triggers>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <ui:TextBlock Margin="0,0,0,20" FontTypography="Body" FontWeight="SemiBold" Text="ã‚¿ã‚¹ã‚¯è©³ç´°" />

                        <ui:TextBlock Margin="0,40,0,0" FontTypography="Body" Text="ã‚¿ã‚¹ã‚¯ã‚’é¸æŠžã—ã¦ãã ã•ã„" TextAlignment="Center" Visibility="{Binding ViewModel.SelectedItem, Converter={x:Static helpers:ObjectToVisibilityConverter.Instance}}" />

                        <StackPanel Visibility="{Binding ViewModel.SelectedItem, Converter={x:Static helpers:ObjectToVisibilityConverter.Instance}}">
                            <!--  åŸºæœ¬æƒ…å ±  -->
                            <Expander Margin="0,0,0,16" Header="åŸºæœ¬æƒ…å ±" IsExpanded="True">
                                <StackPanel>
                                    <!--  ID  -->
                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="ID" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.Id}" />

                                    <!--  ã‚¿ã‚¤ãƒˆãƒ«  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="ã‚¿ã‚¤ãƒˆãƒ«" />
                                    <ui:TextBox x:Name="TitleTextBox" PlaceholderText="ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" Text="{Binding ViewModel.SelectedItem.Title, UpdateSourceTrigger=PropertyChanged}" />

                                    <!--  èª¬æ˜Ž  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="èª¬æ˜Ž" />
                                    <ui:TextBox
                                        x:Name="DescriptionTextBox" Height="80" AcceptsReturn="True" PlaceholderText="ã‚¿ã‚¹ã‚¯ã®è©³ç´°èª¬æ˜Žã‚’å…¥åŠ›"
                                        Text="{Binding ViewModel.SelectedItem.Description, UpdateSourceTrigger=PropertyChanged}"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Expander>

                            <!--  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«  -->
                            <Expander Margin="0,0,0,16" Header="ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«" IsExpanded="True">
                                <StackPanel>
                                    <!--  é–‹å§‹æ—¥  -->
                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="é–‹å§‹æ—¥" />
                                    <DatePicker
                                        DisplayDateEnd="2100-12-31" DisplayDateStart="1900-01-01" FirstDayOfWeek="Monday" IsTodayHighlighted="True"
                                        SelectedDate="{Binding ViewModel.SelectedItem.StartDate, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged" SelectedDateFormat="Short" />

                                    <!--  çµ‚äº†æ—¥  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="çµ‚äº†æ—¥" />
                                    <DatePicker
                                        DisplayDateEnd="2100-12-31" DisplayDateStart="1900-01-01" FirstDayOfWeek="Monday" IsTodayHighlighted="True"
                                        SelectedDate="{Binding ViewModel.SelectedItem.EndDate, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}"
                                        SelectedDateChanged="DatePicker_SelectedDateChanged" SelectedDateFormat="Short" />
                                </StackPanel>
                            </Expander>

                            <!--  é€²æ—ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹  -->
                            <Expander Margin="0,0,0,16" Header="é€²æ—ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" IsExpanded="True">
                                <StackPanel>
                                    <!--  é€²æ—  -->
                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="é€²æ—" />
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Slider
                                            x:Name="ProgressSlider" Grid.Column="0" IsSnapToTickEnabled="True" Maximum="100" Minimum="0"
                                            TickFrequency="10"
                                            Value="{Binding ViewModel.SelectedItem.Progress}" />
                                        <ui:TextBlock Grid.Column="1" Margin="8,0,0,0" VerticalAlignment="Center" FontTypography="Caption" Text="{Binding ViewModel.SelectedItem.Progress, StringFormat={}{0:F0}%}" />
                                    </Grid>

                                    <!--  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" />
                                    <ComboBox SelectedValue="{Binding ViewModel.SelectedItem.Status}">
                                        <ComboBoxItem Content="æœªç€æ‰‹" Tag="æœªç€æ‰‹" />
                                        <ComboBoxItem Content="é€²è¡Œä¸­" Tag="é€²è¡Œä¸­" />
                                        <ComboBoxItem Content="å®Œäº†" Tag="å®Œäº†" />
                                        <ComboBoxItem Content="ä¿ç•™" Tag="ä¿ç•™" />
                                        <ComboBoxItem Content="ã‚­ãƒ£ãƒ³ã‚»ãƒ«" Tag="ã‚­ãƒ£ãƒ³ã‚»ãƒ«" />
                                    </ComboBox>

                                    <!--  å„ªå…ˆåº¦  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="å„ªå…ˆåº¦" />
                                    <ComboBox SelectedValue="{Binding ViewModel.SelectedItem.Priority}">
                                        <ComboBoxItem Content="ä½Ž" Tag="ä½Ž" />
                                        <ComboBoxItem Content="ä¸­" Tag="ä¸­" />
                                        <ComboBoxItem Content="é«˜" Tag="é«˜" />
                                        <ComboBoxItem Content="ç·Šæ€¥" Tag="ç·Šæ€¥" />
                                    </ComboBox>
                                </StackPanel>
                            </Expander>

                            <!--  æ‹…å½“è€…ãƒ»Redmineæƒ…å ±  -->
                            <Expander Margin="0,0,0,16" Header="æ‹…å½“è€…ãƒ»Redmineæƒ…å ±" IsExpanded="False">
                                <StackPanel>
                                    <!--  æ‹…å½“è€…  -->
                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="æ‹…å½“è€…" />
                                    <ui:TextBox PlaceholderText="æ‹…å½“è€…åã‚’å…¥åŠ›" Text="{Binding ViewModel.SelectedItem.Assignee, UpdateSourceTrigger=PropertyChanged}" />

                                    <!--  Redmineæƒ…å ±  -->
                                    <ui:TextBlock Margin="0,16,0,4" FontTypography="Caption" FontWeight="SemiBold" Text="ãƒã‚±ãƒƒãƒˆID" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineIssueId}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineProjectName}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="ãƒˆãƒ©ãƒƒã‚«ãƒ¼" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineTracker}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="ä½œæˆè€…" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineAuthor}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="ä½œæˆæ—¥" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineCreatedOn, StringFormat=yyyy/MM/dd HH:mm}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="æ›´æ–°æ—¥" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineUpdatedOn, StringFormat=yyyy/MM/dd HH:mm}" />

                                    <ui:TextBlock Margin="0,8,0,4" FontTypography="Caption" Text="URL" />
                                    <ui:TextBox IsReadOnly="True" Text="{Binding ViewModel.SelectedItem.RedmineUrl}" />
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </ui:Card>
        </Grid>
    </Grid>
</Page>
