<Window x:Class="RedmineClient.Views.Windows.CreateIssueWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:helpers="clr-namespace:RedmineClient.Helpers"
        Title="チケット登録" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- ヘッダー -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <ui:TextBlock Text="新しいチケットを作成" 
                         FontTypography="Title" 
                         FontSize="24" 
                         Margin="0,0,0,10" />
            <ui:TextBlock Text="{Binding SelectedProject.Name, StringFormat='プロジェクト: {}{0}'}" 
                         FontTypography="Body" 
                         Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
        </StackPanel>

        <!-- メインコンテンツ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- 件名 -->
                <StackPanel Margin="0,0,0,20">
                    <ui:TextBlock Text="件名 *" 
                                 FontTypography="BodyStrong" 
                                 Margin="0,0,0,5" />
                    <ui:TextBox Text="{Binding Subject, UpdateSourceTrigger=PropertyChanged}" 
                               PlaceholderText="チケットの件名を入力してください" />
                </StackPanel>

                <!-- 説明 -->
                <StackPanel Margin="0,0,0,20">
                    <ui:TextBlock Text="説明 *" 
                                 FontTypography="BodyStrong" 
                                 Margin="0,0,0,5" />
                    <ui:TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                               PlaceholderText="チケットの詳細説明を入力してください"
                               AcceptsReturn="True"
                               TextWrapping="Wrap"
                               Height="100" />
                </StackPanel>

                <!-- 日付と時間 -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- 開始日 -->
                    <StackPanel Grid.Column="0">
                        <ui:TextBlock Text="開始日" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <DatePicker SelectedDate="{Binding StartDate}" />
                    </StackPanel>

                    <!-- 終了日 -->
                    <StackPanel Grid.Column="2">
                        <ui:TextBlock Text="終了日" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <DatePicker SelectedDate="{Binding DueDate}" />
                    </StackPanel>

                    <!-- 予定時間 -->
                    <StackPanel Grid.Column="4">
                        <ui:TextBlock Text="予定時間（時間）" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <TextBox Text="{Binding EstimatedHours, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>
                </Grid>

                <!-- トラッカー、ステータス、優先度 -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- トラッカー -->
                    <StackPanel Grid.Column="0">
                        <ui:TextBlock Text="トラッカー" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <ComboBox ItemsSource="{Binding AvailableTrackers}" 
                                  SelectedItem="{Binding SelectedTracker}"
                                  DisplayMemberPath="Name" />
                    </StackPanel>

                    <!-- ステータス -->
                    <StackPanel Grid.Column="2">
                        <ui:TextBlock Text="ステータス" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <ComboBox ItemsSource="{Binding AvailableStatuses}" 
                                  SelectedItem="{Binding SelectedStatus}"
                                  DisplayMemberPath="Name" />
                    </StackPanel>

                    <!-- 優先度 -->
                    <StackPanel Grid.Column="4">
                        <ui:TextBlock Text="優先度" 
                                     FontTypography="BodyStrong" 
                                     Margin="0,0,0,5" />
                        <ComboBox ItemsSource="{Binding AvailablePriorities}" 
                                  SelectedItem="{Binding SelectedPriority}"
                                  DisplayMemberPath="Name" />
                    </StackPanel>
                </Grid>

                <!-- ウォッチャー登録オプション -->
                <StackPanel Margin="0,0,0,20">
                    <CheckBox Content="作成者をウォッチャーとして登録する" 
                              IsChecked="{Binding AddAsWatcher}" 
                              Margin="0,0,0,5" />
                    <ui:TextBlock Text="チェックすると、作成したチケットのウォッチャーとして自動で登録されます。" 
                                 FontSize="12" 
                                 Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                 TextWrapping="Wrap" />
                </StackPanel>

                <!-- エラーメッセージ -->
                <ui:Card Padding="12" 
                         BorderThickness="1" 
                         Visibility="{Binding ErrorMessage, Converter={x:Static helpers:ObjectToVisibilityConverter.Instance}}"
                         Margin="0,0,0,20">
                    <ui:TextBlock Text="{Binding ErrorMessage}" 
                                 Foreground="Red" 
                                 TextWrapping="Wrap" />
                </ui:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- ボタン -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,20,0,0">
            <ui:Button Content="キャンセル" 
                       Command="{Binding CancelCommand}" 
                       Appearance="Secondary" 
                       Margin="0,0,10,0" />
            <ui:Button Content="チケット作成" 
                       Command="{Binding CreateIssueCommand}" 
                       Appearance="Primary" 
                       Icon="Add" />
        </StackPanel>

        <!-- ローディング表示 -->
        <ui:ProgressRing Grid.Row="1" 
                         IsIndeterminate="True" 
                         Visibility="{Binding IsLoading, Converter={x:Static helpers:BooleanToVisibilityConverter.Instance}}" />
    </Grid>
</Window>
